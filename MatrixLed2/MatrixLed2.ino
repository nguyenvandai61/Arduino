// 2-dimensional array of row pin numbers:
int R[] = {2, 7, A5, 5, 13, A4, 12, A2};
// 2-dimensional array of column pin numbers:
int C[] = {6, 11, 10, 1, A3, 4, 8, 9};
// Port 3 Not good change 3 -> 1


unsigned int BIT[8][8]={
    1,0,0,0,0,0,0,0,  
    0,0,0,0,0,0,0,0,  
    0,0,0,0,0,0,0,0,  
    0,0,0,0,0,0,0,0,  
    0,0,0,0,0,0,0,0,  
    0,0,0,0,0,0,0,0,  
    0,0,0,0,0,0,0,0,  
    0,0,0,0,0,0,0,0,
};
unsigned int characterHEX[][8] = {
  {0x18, 0x3C, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66}, //A
  {0x78, 0x64, 0x68, 0x78, 0x64, 0x66, 0x66, 0x7C}, //B
  {0x3C, 0x62, 0x60, 0x60, 0x60, 0x62, 0x62, 0x3C}, //C
  {0x78, 0x64, 0x66, 0x66, 0x66, 0x66, 0x64, 0x78}, //D
  {0x7E, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x60, 0x7E}, //E
  {0x7E, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x60, 0x60}, //F
  {0x3C, 0x62, 0x60, 0x60, 0x66, 0x62, 0x62, 0x3C}, //G
  {0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x66}, //H
  {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7E}, //I
  {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x1A, 0x0C}, //J
  {0x62, 0x64, 0x68, 0x70, 0x70, 0x68, 0x64, 0x62}, //K
  {0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7E}, //L
  {0xC3, 0xE7, 0xDB, 0xDB, 0xC3, 0xC3, 0xC3, 0xC3}, //M
  {0x62, 0x62, 0x52, 0x52, 0x4A, 0x4A, 0x46, 0x46}, //N
  {0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C}, //O
  {0x7C, 0x62, 0x62, 0x7C, 0x60, 0x60, 0x60, 0x60}, //P
  {0x38, 0x64, 0x64, 0x64, 0x64, 0x6C, 0x64, 0x3A}, //Q
  {0x7C, 0x62, 0x62, 0x7C, 0x70, 0x68, 0x64, 0x62}, //R
  {0x1C, 0x22, 0x30, 0x18, 0x0C, 0x46, 0x46, 0x3C}, //S
  {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18}, //T
  {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C}, //U
  {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18}, //V
  {0x81, 0x81, 0x81, 0x81, 0x81, 0x99, 0x99, 0x66}, //W
  {0x42, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x42}, //X
  {0xC3, 0x66, 0x3C, 0x18, 0x18, 0x18, 0x18, 0x18}, //Y
  {0x7E, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x7E}, //Z
  {0x3C, 0x66, 0x66, 0x6E, 0x76, 0x66, 0x66, 0x3C}, //0
  {0x18, 0x38, 0x58, 0x18, 0x18, 0x18, 0x18, 0x7E}, //1
  {0x3C, 0x66, 0x66, 0x0C, 0x18, 0x30, 0x7E, 0x7E}, //2
  {0x7E, 0x0C, 0x18, 0x3C, 0x06, 0x06, 0x46, 0x3C}, //3
  {0x0C, 0x18, 0x30, 0x6C, 0x6C, 0x7E, 0x0C, 0x0C}, //4
  {0x7E, 0x60, 0x60, 0x7C, 0x06, 0x06, 0x46, 0x3C}, //5
  {0x04, 0x08, 0x10, 0x38, 0x6C, 0x66, 0x66, 0x3C}, //6
  {0x7E, 0x46, 0x0C, 0x18, 0x18, 0x18, 0x18, 0x18}, //7
  {0x3C, 0x66, 0x66, 0x3C, 0x66, 0x66, 0x66, 0x3C}, //8
  {0x3C, 0x66, 0x66, 0x36, 0x1C, 0x08, 0x10, 0x20}, //9
  {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}, // " "
};
char character[] = {'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ' '};



void setup()
{
  Serial.begin(9600);
  // iterate over the pins:
  for (int i = 0; i < 8; i++)
    // initialize the output pins:
  {
    pinMode(R[i], OUTPUT);
    pinMode(C[i], OUTPUT);
  }
  Serial.println("Nhap ten: ");

}

void loop()
{
  String string = "HELLO WORLD";
  Serial.println(string);

  for (int i = 0; i < 8; i++) {
    for (int j = 0; j < 8; j++) {
      Serial.print(BIT[i][j]);
    }
    Serial.println();
  }


  while (Serial.available() == 0)
  {
    for (int k = 0; k < string.length(); k++)
    {
      for (int i = 0; i < sizeof(character); i++)
      {
        if (string.charAt(k) == character[i])
        {
          ChuyenDoi(i);
          for (int z = 0; z < 100; z++) {
            Display(BIT);
          }

          break;
        }
        /*So sanh ky tu vua nhap voi mang character*/
        if ((i == (sizeof(character) - 1)) && (string.charAt(k) != character[i]))
        {
          Serial.print(string.charAt(k));
          Serial.println(":invalid character");
        }
      }
      /*kiểm tra xem có dữ liệu mới hay không*/
      if (Serial.available() > 0)
        break;
    }
    delay(300);
  }
}

void Display(unsigned int dat[8][8])
{
  for (int c = 0; c < 8; c++)
  {
    digitalWrite(C[c], HIGH); //use thr column
    //loop
    for (int r = 0; r < 8; r++)
    {
      digitalWrite(R[r], Dao(dat[r][c]));
    }
    delay(1);
    Clear();  //Remove empty display light
  }
}
int Dao(int x) {
  if (x == 1)
    x = 0;
  else x = 1;
  return x;
}

/* LedMat chua ma tran ky tu moi*/
void LedMat(int x) {
  int val;
  for (int i = 0 ; i < 8 ; i++) {
    val = characterHEX[x][i];
    for (int j = 7; j >= 0; j--) {
      BIT[i][j] = val % 2;
      val /= 2;
    }
  }
}

/* Tat het led */
void Clear()
{
  for (int i = 0; i < 8; i++)
  {
    digitalWrite(R[i], HIGH);
    digitalWrite(C[i], LOW);
  }
}
